<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Kartei‚ÄëKarten Generator</title>
    <link rel="stylesheet" href="/static/styles.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Lora:wght@400;600&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
      .layout { display: grid; grid-template-columns: 1fr 360px; gap: 12px; padding: 12px; height: calc(100% - 58px); }
      .panel { background: var(--panel); border: 1px solid #1f2937; border-radius: 10px; padding: 12px; overflow: auto; }
      .toolbar { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 8px; }
      .grid { width: 100%; border-collapse: collapse; }
      .grid th, .grid td { border: 1px solid #374151; padding: 6px 8px; }
      .grid input { width: 100%; border: none; outline: none; background: transparent; color: var(--text); }
      .muted { color: var(--muted); font-size: 13px; }
      .card-preview { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
      .card { background: #0b1220; border: 1px solid #1f2937; border-radius: 10px; padding: 16px; min-height: 180px; display: grid; place-items: center; text-align: center; }
      .row { display: flex; gap: 8px; align-items: center; }
      .field { display: grid; gap: 6px; margin-bottom: 8px; }
      select, input[type="number"], input[type="text"] { background: #0b1220; color: var(--text); border: 1px solid #374151; border-radius: 6px; padding: 6px 8px; }
    </style>
    <!-- libs via CDN for MVP: PapaParse, SheetJS, jsPDF, html2canvas, JSZip -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  </head>
  <body>
    <header class="app-header">
      <h1>Kartei‚ÄëKarten Generator</h1>
      <nav>
        <a href="/" class="btn">Hub</a>
      </nav>
    </header>

    <main class="layout">
      <section class="panel">
        <div class="toolbar">
          <label class="btn" style="position: relative; overflow: hidden;" title="Datei laden">
            üìÇ
            <input id="fileInput" type="file" accept=".csv,.xlsx,.xls,.ods" style="position:absolute; inset:0; opacity:0; cursor:pointer;" />
          </label>
          <button id="addRow" class="btn" title="Zeile hinzuf√ºgen">‚ûï</button>
          <button id="duplicateRows" class="btn" title="Ausgew√§hlte duplizieren">‚éò</button>
          <button id="deleteRows" class="btn" title="Ausgew√§hlte l√∂schen">üóëÔ∏è</button>
          <label class="row muted"><input id="hasHeader" type="checkbox" /> Erste Zeile ist Header</label>
          <span id="rowCount" class="muted">0 Zeilen</span>
          <span id="validation" class="muted"></span>
          <button id="undo" class="btn" title="R√ºckg√§ngig">‚Ü∂</button>
          <button id="redo" class="btn" title="Wiederholen">‚Ü∑</button>
        </div>

        <table class="grid" id="dataGrid" aria-label="Tabellenansicht">
          <thead>
            <tr>
              <th style="width:36px;"><input type="checkbox" id="selectAll" title="Alle ausw√§hlen" /></th>
              <th style="width:30px;">‚ÜïÔ∏é</th>
              <th>A (Vorderseite)</th>
              <th>B (R√ºckseite)</th>
            </tr>
          </thead>
          <tbody id="gridBody"></tbody>
        </table>
      </section>

      <aside class="panel">
        <div class="field">
          <label>Spaltenzuordnung</label>
          <div class="row">
            <span class="muted">Vorderseite:</span>
            <select id="colA"></select>
            <span class="muted">R√ºckseite:</span>
            <select id="colB"></select>
          </div>
        </div>

        <div class="field">
          <label>Darstellung</label>
          <div class="row">
            <button id="alignToggle" class="btn" title="Textausrichtung umschalten">‚ü∫</button>
            <label class="muted">Schriftgr√∂√üe (px) <input id="fontPx" type="number" value="28" step="1" /></label>
          </div>
          <div class="row">
            <label class="muted">Hintergrundfarbe <input id="bgColor" type="color" value="#ffffff" /></label>
            <label class="muted">Rahmen <input id="borderEnabled" type="checkbox" checked /></label>
            <label class="muted">Farbe <input id="borderColor" type="color" value="#334155" /></label>
          </div>
        </div>
        <div class="field">
          <label>Hintergr√ºnde</label>
          <div class="row">
            <label class="btn" style="position: relative; overflow: hidden;" title="Vorderseite Bild">
              üñºÔ∏è Front
              <input id="bgFront" type="file" accept="image/*" style="position:absolute; inset:0; opacity:0; cursor:pointer;" />
            </label>
            <button id="bgFrontClear" class="btn" title="Front entfernen">‚úñ</button>
          </div>
          <div class="row">
            <label class="btn" style="position: relative; overflow: hidden;" title="R√ºckseite Bild">
              üñºÔ∏è Back
              <input id="bgBack" type="file" accept="image/*" style="position:absolute; inset:0; opacity:0; cursor:pointer;" />
            </label>
            <button id="bgBackClear" class="btn" title="Back entfernen">‚úñ</button>
          </div>
          <div class="row">
            <span class="muted">Bildanpassung:</span>
            <select id="bgMode">
              <option value="cover" selected>F√ºllen (cover)</option>
              <option value="contain">Einpassen (contain)</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label>Export</label>
          <div class="row">
            <label class="muted">Format
              <select id="exportFormat">
                <option value="pdf" selected>PDF</option>
                <option value="png">PNG</option>
                <option value="jpg">JPG</option>
              </select>
            </label>
            <label class="muted">Inhalt
              <select id="exportSide">
                <option value="front">Front</option>
                <option value="back">Back</option>
                <option value="both" selected>Front+Back</option>
              </select>
            </label>
          </div>
          <div class="row">
            <label class="muted">Pro Seite
              <select id="cardsPerPage">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="4" selected>4</option>
                <option value="6">6</option>
                <option value="8">8</option>
              </select>
            </label>
            <label class="muted">Papier
              <select id="paperSize">
                <option value="A4" selected>A4</option>
                <option value="A6">A6</option>
              </select>
            </label>
            <button id="downloadBtn" class="btn primary">Herunterladen</button>
          </div>
        </div>

        <div class="field">
          <label>Dateinamensvorlage</label>
          <input id="filenameTpl" type="text" value="karte_{index}_{front}" />
          <div class="muted">Platzhalter: {index}, {front}, {back}</div>
        </div>

        <div class="field">
          <label>Live‚ÄëVorschau (erste ausgew√§hlte Zeile)</label>
          <div class="card-preview">
            <div class="card" id="previewFront" aria-label="Vorderseite"></div>
            <div class="card" id="previewBack" aria-label="R√ºckseite"></div>
          </div>
        </div>

        
      </aside>
    </main>

    <template id="cardTemplate">
      <div class="card" data-card>
        <div class="front" data-front></div>
        <div class="back" data-back style="display:none;"></div>
      </div>
    </template>

    <script src="/static/flashcards.js"></script>
  </body>
</html>

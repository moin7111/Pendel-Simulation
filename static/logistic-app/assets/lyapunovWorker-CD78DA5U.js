(function(){"use strict";let h=!1,q=!1,M=!1;const x=[],U=()=>q?new Promise(e=>{x.push(e)}):Promise.resolve(),y=e=>{if(q=e,!q)for(;x.length;)x.pop()?.()},W=()=>{h=!1,y(!1),M=!1},l=e=>{self.postMessage(e)},k=e=>!Number.isFinite(e)||Number.isNaN(e)||e<=0?1e-12:e>=1?1-1e-12:e,B=(e,t)=>{const s=t*e*(1-e);return k(s)},z=()=>new Promise(e=>setTimeout(e,0)),A=(e,t)=>{if(e.length<2||t.length<2||e.length!==t.length)return null;const s=e.length;let i=0,d=0,m=0,v=0;for(let n=0;n<s;n+=1){const a=e[n],r=t[n];i+=a,d+=r,m+=a*a,v+=a*r}const w=s*m-i*i;if(Math.abs(w)<1e-12)return null;const F=(s*v-i*d)/w,g=(d-F*i)/s;let L=0,o=0;const u=d/s;for(let n=0;n<s;n+=1){const a=e[n],r=t[n],f=F*a+g;L+=(r-f)**2,o+=(r-u)**2}const P=o===0?1:1-L/o;return{slope:F,intercept:g,rSquared:P}},H=async e=>{const{r:t,x0:s,delta0:i,totalIters:d,transient:m,renormSteps:v,chunkSize:w,sampleEvery:F}=e,g=m+d,L=Math.max(1,F),o=[],u=[],P=[],n=[],a=[];let r=k(s),f=k(s+i),b=0;const R=Math.max(1,v);let E=0,D=0,S=Number.NaN;for(let c=0;c<g;c+=1){if(M){l({type:"error",message:"Berechnung abgebrochen."});return}if(await U(),r=B(r,t),f=B(f,t),!Number.isFinite(r)||!Number.isFinite(f)){l({type:"error",message:"Numerischer Überlauf in der Simulation."});return}const T=f-r;let N=Math.abs(T);(!Number.isFinite(N)||N<1e-18)&&(N=1e-18);const C=N,I=c-m,Y=c>=m,J=Y&&(c-m)%L===0;if(Y){if(b+=1,b>=R){b=0;const p=Math.log(N/i);Number.isFinite(p)&&(D+=p,E+=1,S=D/(E*R));const _=T>=0?1:-1;f=k(r+_*i)}}else if(b+=1,b>=R){b=0;const p=T>=0?1:-1;f=k(r+p*i)}if(Y&&J){const p=Math.log(C),_={t:I,d:C,ln_d:p};Number.isFinite(S)&&(_.lambda_running=S),o.push(_),u.push(I),P.push(N),n.push(p),a.push(Number.isFinite(S)?S:Number.NaN)}o.length>=w&&(l({type:"chunk",points:[...o]}),o.length=0),((c+1)%w===0||c===g-1)&&l({type:"progress",done:c+1,total:g}),(c&255)===0&&await z()}o.length&&l({type:"chunk",points:[...o]});const G=E>0?D/(E*R):Number.NaN,X=A(u,n);X&&l({type:"fit",slope:X.slope,intercept:X.intercept,window:[u[0]??0,u[u.length-1]??0],rSquared:X.rSquared}),l({type:"result",lambda:G,times:u,d:P,ln_d:n,running_lambda:a.length?a:void 0})},j=async e=>{h=!0,M=!1,y(!1);try{await H(e)}catch(t){const s=t instanceof Error?t.message:"Unbekannter Worker-Fehler.";l({type:"error",message:s})}finally{W()}};self.addEventListener("message",e=>{const t=e.data;if(t)switch(t.cmd){case"start":if(h){l({type:"error",message:"Es läuft bereits eine Berechnung."});return}j(t.params);break;case"pause":h&&y(!0);break;case"resume":h&&y(!1);break;case"abort":h&&(M=!0,y(!1));break}})})();
//# sourceMappingURL=lyapunovWorker-CD78DA5U.js.map
